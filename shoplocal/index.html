
<!DOCTYPE html>
<html lang="ur" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>دکان کا بل</title>
    <style>
        @font-face {
            font-family: 'Jameel Noori Nastaleeq';
            src: url('data:application/font-woff2;base64,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');
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Jameel Noori Nastaleeq', Arial, sans-serif;
        }
        
        body {
            direction: rtl;
            background-color: #f9f9f9;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #000;
            padding-bottom: 10px;
        }
        
        .shop-name {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .shop-address, .shop-contact {
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .receipt-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .customer-info {
            border: 1px solid #000;
            padding: 10px;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        th, td {
            border: 1px solid #000;
            padding: 8px;
            text-align: right;
        }
        
        th {
            background-color: #f2f2f2;
        }
        
        .totals {
            text-align: left;
            margin-bottom: 20px;
        }
        
        .totals div {
            margin-bottom: 5px;
        }
        
        .signature {
            margin-top: 40px;
            text-align: left;
        }
        
        .signature-line {
            width: 200px;
            border-top: 1px solid #000;
            margin-top: 30px;
            padding-top: 5px;
            text-align: center;
        }
        
        .app-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #eee;
            margin-left: 5px;
            border-radius: 5px 5px 0 0;
        }
        
        .tab.active {
            background-color: #4CAF50;
            color: white;
        }
        
        .tab-content {
            display: none;
            border: 1px solid #ddd;
            padding: 20px;
            background-color: white;
        }
        
        .tab-content.active {
            display: block;
        }
        
        button, input[type="submit"] {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            cursor: pointer;
            border-radius: 4px;
        }
        
        button:hover, input[type="submit"]:hover {
            background-color: #45a049;
        }
        
        input, select, textarea {
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100%;
            font-family: 'Jameel Noori Nastaleeq', Arial, sans-serif;
            text-align: right;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-gap: 20px;
        }
        
        .receipt-preview {
            padding: 20px;
            border: 1px solid #ddd;
            background-color: white;
            margin-top: 20px;
        }
        
        .card {
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        @media print {
            .app-container, .tabs, button:not(.print-hide) {
                display: none;
            }
            .container {
                box-shadow: none;
                margin: 0;
                padding: 0;
            }
        }
        
        .item-row {
            display: flex;
            margin-bottom: 10px;
        }
        
        .item-row input, .item-row select {
            margin-left: 5px;
        }
        
        .remove-item {
            background-color: #f44336;
        }
        
        .customer-list, .product-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        
        .list-item {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            cursor: pointer;
        }
        
        .list-item:hover {
            background-color: #f5f5f5;
        }
        
        .payment-history {
            margin-top: 20px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 100;
        }
        
        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            width: 60%;
            border-radius: 5px;
            position: relative;
        }
        
        .close {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>
<div class="app-container">
<h1 style="text-align: center; margin-bottom: 20px;">نظام بل</h1>

        <div class="tabs">
            <div class="tab active" data-tab="new-receipt">نیا بل</div>
            <div class="tab" data-tab="customers">گاہک</div>
            <div class="tab" data-tab="products">پروڈکٹس</div>
            <div class="tab" data-tab="khata">کھاتہ</div>
            <div class="tab" data-tab="settings">ترتیبات</div>
        </div>
        
        <div id="new-receipt" class="tab-content active">
            <div class="grid">
                <div>
                    <div class="card">
                        <h2>گاہک کی معلومات</h2>
                        <div class="form-group">
                            <label for="customer">گاہک:</label>
                            <select id="customer">
                                <option value="">نیا گاہک</option>
                            </select>
                        </div>
                        
                        <div id="new-customer-form">
                            <div class="form-group">
                                <label for="customer-name">نام:</label>
                                <input type="text" id="customer-name">
                            </div>
                            <div class="form-group">
                                <label for="customer-phone">فون:</label>
                                <input type="text" id="customer-phone">
                            </div>
                            <div class="form-group">
                                <label for="customer-address">پتہ:</label>
                                <textarea id="customer-address"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h2>آئٹم شامل کریں</h2>
                        <div class="form-group">
                            <label for="product">پروڈکٹ:</label>
                            <select id="product">
                                <option value="">منتخب کریں</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="quantity">تعداد:</label>
                            <input type="number" id="quantity" min="1" value="1">
                        </div>
                        
                        <button id="add-item">شامل کریں</button>
                    </div>
                    
                    <div class="card">
                        <h2>ادائیگی</h2>
                        <div class="form-group">
                            <label for="discount">رعایت:</label>
                            <input type="number" id="discount" min="0" value="0">
                        </div>
                        
                        <div class="form-group">
                            <label for="amount-paid">ادا کردہ رقم:</label>
                            <input type="number" id="amount-paid" min="0" value="0">
                        </div>
                        
                        <div class="form-group">
                            <label for="receipt-date">تاریخ:</label>
                            <input type="date" id="receipt-date">
                        </div>
                        
                        <button id="generate-receipt">بل تیار کریں</button>
                        <button id="save-receipt">محفوظ کریں</button>
                        <button id="print-receipt">پرنٹ کریں</button>
                    </div>
                </div>
                
                <div>
                    <div class="card">
                        <h2>آئٹمز</h2>
                        <table id="items-table">
                            <thead>
                                <tr>
                                    <th>نمبر</th>
                                    <th>تعداد</th>
                                    <th>تفصیل</th>
                                    <th>نرخ</th>
                                    <th>روپے</th>
                                    <th>کارروائی</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                        
                        <div class="totals">
                            <div><strong>کل رقم:</strong> <span id="total-amount">0</span> روپے</div>
                            <div><strong>رعایت:</strong> <span id="discount-amount">0</span> روپے</div>
                            <div><strong>واجب الادا رقم:</strong> <span id="net-amount">0</span> روپے</div>
                            <div><strong>ادا کردہ رقم:</strong> <span id="paid-amount">0</span> روپے</div>
                            <div><strong>باقی رقم:</strong> <span id="remaining-amount">0</span> روپے</div>
                        </div>
                    </div>
                    
                    <div id="receipt-preview" class="receipt-preview">
                        <div class="container">
                            <div class="header">
                                <div class="shop-name" id="preview-shop-name">دکان کا نام</div>
                                <div class="shop-address" id="preview-shop-address">دکان کا پتہ</div>
                                <div class="shop-contact" id="preview-shop-contact">فون: XXX-XXXXXXX</div>
                            </div>
                            
                            <div class="receipt-info">
                                <div>بل نمبر: <span id="preview-receipt-number">001</span></div>
                                <div>تاریخ: <span id="preview-date"></span></div>
                            </div>
                            
                            <div class="customer-info">
                                <div>گاہک: <span id="preview-customer-name">گاہک کا نام</span></div>
                                <div>فون: <span id="preview-customer-phone">گاہک کا فون</span></div>
                                <div>پتہ: <span id="preview-customer-address">گاہک کا پتہ</span></div>
                            </div>
                            
                            <table id="preview-items-table">
                                <thead>
                                    <tr>
                                        <th>نمبر</th>
                                        <th>تعداد</th>
                                        <th>تفصیل</th>
                                        <th>نرخ</th>
                                        <th>روپے</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                            
                            <div class="totals">
                                <div>کل رقم: <span id="preview-total-amount">0</span> روپے</div>
                                <div>رعایت: <span id="preview-discount-amount">0</span> روپے</div>
                                <div>واجب الادا رقم: <span id="preview-net-amount">0</span> روپے</div>
                                <div>ادا کردہ رقم: <span id="preview-paid-amount">0</span> روپے</div>
                                <div>باقی رقم: <span id="preview-remaining-amount">0</span> روپے</div>
                            </div>
                            
                            <div class="signature">
                                <div class="signature-line">دستخط</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="customers" class="tab-content">
            <div class="grid">
                <div>
                    <div class="card">
                        <h2>نیا گاہک شامل کریں</h2>
                        <div class="form-group">
                            <label for="new-customer-name">نام:</label>
                            <input type="text" id="new-customer-name">
                        </div>
                        <div class="form-group">
                            <label for="new-customer-phone">فون:</label>
                            <input type="text" id="new-customer-phone">
                        </div>
                        <div class="form-group">
                            <label for="new-customer-address">پتہ:</label>
                            <textarea id="new-customer-address"></textarea>
                        </div>
                        <button id="add-customer">شامل کریں</button>
                    </div>
                </div>
                
                <div>
                    <div class="card">
                        <h2>گاہک کی فہرست</h2>
                        <input type="text" id="customer-search" placeholder="تلاش...">
                        <div class="customer-list" id="customer-list"></div>
                    </div>
                </div>
            </div>
            
            <div class="card" id="customer-details" style="display: none;">
                <h2>گاہک کی تفصیلات</h2>
                <div id="customer-details-content"></div>
                <div class="payment-history">
                    <h3>گاہک کا تاریخ</h3>
                    <table id="customer-history">
                        <thead>
                            <tr>
                                <th>تاریخ</th>
                                <th>بل نمبر</th>
                                <th>کل رقم</th>
                                <th>ادا کردہ رقم</th>
                                <th>باقی رقم</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <button id="edit-customer">ترمیم کریں</button>
                <button id="delete-customer">حذف کریں</button>
            </div>
        </div>
        
        <div id="products" class="tab-content">
            <div class="grid">
                <div>
                    <div class="card">
                        <h2>نیا پروڈکٹ شامل کریں</h2>
                        <div class="form-group">
                            <label for="new-product-name">نام:</label>
                            <input type="text" id="new-product-name">
                        </div>
                        <div class="form-group">
                            <label for="new-product-description">تفصیل:</label>
                            <textarea id="new-product-description"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="new-product-rate">نرخ:</label>
                            <input type="number" id="new-product-rate" min="0">
                        </div>
                        <button id="add-product">شامل کریں</button>
                    </div>
                </div>
                
                <div>
                    <div class="card">
                        <h2>پروڈکٹس کی فہرست</h2>
                        <input type="text" id="product-search" placeholder="تلاش...">
                        <div class="product-list" id="product-list"></div>
                    </div>
                </div>
            </div>
            
            <div class="card" id="product-details" style="display: none;">
                <h2>پروڈکٹ کی تفصیلات</h2>
                <div id="product-details-content"></div>
                <button id="edit-product">ترمیم کریں</button>
                <button id="delete-product">حذف کریں</button>
            </div>
        </div>
        
        <div id="khata" class="tab-content">
            <div class="card">
                <h2>کھاتہ کی فہرست</h2>
                <input type="text" id="khata-search" placeholder="تلاش...">
                <table id="khata-table">
                    <thead>
                        <tr>
                            <th>گاہک</th>
                            <th>کل بیلنس</th>
                            <th>آخری لین دین</th>
                            <th>کارروائی</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            
            <div class="card" id="khata-details" style="display: none;">
                <h2>کھاتہ کی تفصیلات</h2>
                <div id="khata-customer-info"></div>
                <table id="khata-history">
                    <thead>
                        <tr>
                            <th>تاریخ</th>
                            <th>تفصیل</th>
                            <th>ڈیبٹ</th>
                            <th>کریڈٹ</th>
                            <th>بیلنس</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <div class="form-group">
                    <label for="payment-amount">ادائیگی کی رقم:</label>
                    <input type="number" id="payment-amount" min="0">
                </div>
                <button id="add-payment">ادائیگی شامل کریں</button>
            </div>
        </div>
        
        <div id="settings" class="tab-content">
            <div class="card">
                <h2>دکان کی ترتیبات</h2>
                <div class="form-group">
                    <label for="shop-name">دکان کا نام:</label>
                    <input type="text" id="shop-name">
                </div>
                <div class="form-group">
                    <label for="shop-address">دکان کا پتہ:</label>
                    <textarea id="shop-address"></textarea>
                </div>
                <div class="form-group">
                    <label for="shop-phone">دکان کا فون:</label>
                    <input type="text" id="shop-phone">
                </div>
                <div class="form-group">
                    <label for="shop-logo">دکان کا لوگو:</label>
                    <input type="file" id="shop-logo" accept="image/*">
                </div>
                <button id="save-settings">محفوظ کریں</button>
            </div>
            
            <div class="card">
                <h2>بل کی ترتیبات</h2>
                <div class="form-group">
                    <label for="next-receipt-number">اگلا بل نمبر:</label>
                    <input type="number" id="next-receipt-number" min="1">
                </div>
                <button id="save-receipt-settings">محفوظ کریں</button>
            </div>
        </div>
    </div>
    
    <!-- Edit Customer Modal -->
    <div id="edit-customer-modal" class="modal">
        <div class="modal-content">
            <span class="close" id="close-edit-customer">&times;</span>
            <h2>گاہک میں ترمیم کریں</h2>
            <div class="form-group">
                <label for="edit-customer-name">نام:</label>
                <input type="text" id="edit-customer-name">
            </div>
            <div class="form-group">
                <label for="edit-customer-phone">فون:</label>
                <input type="text" id="edit-customer-phone">
            </div>
            <div class="form-group">
                <label for="edit-customer-address">پتہ:</label>
                <textarea id="edit-customer-address"></textarea>
            </div>
            <input type="hidden" id="edit-customer-id">
            <button id="update-customer">اپ ڈیٹ کریں</button>
        </div>
    </div>
    
    <!-- Edit Product Modal -->
    <div id="edit-product-modal" class="modal">
        <div class="modal-content">
            <span class="close" id="close-edit-product">&times;</span>
            <h2>پروڈکٹ میں ترمیم کریں</h2>
            <div class="form-group">
                <label for="edit-product-name">نام:</label>
                <input type="text" id="edit-product-name">
            </div>
            <div class="form-group">
                <label for="edit-product-description">تفصیل:</label>
                <textarea id="edit-product-description"></textarea>
            </div>
            <div class="form-group">
                <label for="edit-product-rate">نرخ:</label>
                <input type="number" id="edit-product-rate" min="0">
            </div>
            <input type="hidden" id="edit-product-id">
            <button id="update-product">اپ ڈیٹ کریں</button>
        </div>
    </div>
    
    <script>
        // Initialize IndexedDB
        const dbName = 'receiptSystemDB';
        const dbVersion = 1;
        let db;
    
        const request = indexedDB.open(dbName, dbVersion);
    
        request.onerror = function(event) {
            console.error("Database error: " + event.target.errorCode);
        };
    
        request.onupgradeneeded = function(event) {
            db = event.target.result;
            
            // Create object stores
            if (!db.objectStoreNames.contains('customers')) {
                const customerStore = db.createObjectStore('customers', { keyPath: 'id', autoIncrement: true });
                customerStore.createIndex('name', 'name', { unique: false });
                customerStore.createIndex('phone', 'phone', { unique: false });
            }
            
            if (!db.objectStoreNames.contains('products')) {
                const productStore = db.createObjectStore('products', { keyPath: 'id', autoIncrement: true });
                productStore.createIndex('name', 'name', { unique: false });
            }
            
            if (!db.objectStoreNames.contains('receipts')) {
                const receiptStore = db.createObjectStore('receipts', { keyPath: 'id', autoIncrement: true });
                receiptStore.createIndex('customerId', 'customerId', { unique: false });
                receiptStore.createIndex('date', 'date', { unique: false });
                receiptStore.createIndex('receiptNumber', 'receiptNumber', { unique: true });
            }
            
            if (!db.objectStoreNames.contains('settings')) {
                db.createObjectStore('settings', { keyPath: 'id' });
            }
            
            if (!db.objectStoreNames.contains('transactions')) {
                const transactionStore = db.createObjectStore('transactions', { keyPath: 'id', autoIncrement: true });
                transactionStore.createIndex('customerId', 'customerId', { unique: false });
                transactionStore.createIndex('date', 'date', { unique: false });
            }
        };
    
        request.onsuccess = function(event) {
            db = event.target.result;
            console.log("Database opened successfully");
            
            // Initialize the app
            initApp();
        };
    
        function initApp() {
            // Load settings
            loadSettings();
            
            // Load customers
            loadCustomers();
            
            // Load products
            loadProducts();
            
            // Load khata
            loadKhata();
            
            // Set current date
            document.getElementById('receipt-date').valueAsDate = new Date();
            
            // Tab navigation
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active class from all tabs
                    tabs.forEach(t => t.classList.remove('active'));
                    
                    // Add active class to clicked tab
                    tab.classList.add('active');
                    
                    // Hide all tab contents
                    const contents = document.querySelectorAll('.tab-content');
                    contents.forEach(content => content.classList.remove('active'));
                    
                    // Show the selected tab content
                    const tabId = tab.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // Add event listeners
            document.getElementById('add-customer').addEventListener('click', addCustomer);
            document.getElementById('add-product').addEventListener('click', addProduct);
            document.getElementById('add-item').addEventListener('click', addItemToReceipt);
            document.getElementById('generate-receipt').addEventListener('click', generateReceipt);
            document.getElementById('save-receipt').addEventListener('click', saveReceipt);
            document.getElementById('print-receipt').addEventListener('click', printReceipt);
            document.getElementById('save-settings').addEventListener('click', saveSettings);
            document.getElementById('save-receipt-settings').addEventListener('click', saveReceiptSettings);
            document.getElementById('customer').addEventListener('change', handleCustomerChange);
            document.getElementById('edit-customer').addEventListener('click', showEditCustomerModal);
            document.getElementById('delete-customer').addEventListener('click', deleteCustomer);
            document.getElementById('update-customer').addEventListener('click', updateCustomer);
            document.getElementById('close-edit-customer').addEventListener('click', closeEditCustomerModal);
            document.getElementById('edit-product').addEventListener('click', showEditProductModal);
            document.getElementById('delete-product').addEventListener('click', deleteProduct);
            document.getElementById('update-product').addEventListener('click', updateProduct);
            document.getElementById('close-edit-product').addEventListener('click', closeEditProductModal);
            document.getElementById('discount').addEventListener('input', updateTotals);
            document.getElementById('amount-paid').addEventListener('input', updateTotals);
            document.getElementById('customer-search').addEventListener('input', filterCustomers);
            document.getElementById('product-search').addEventListener('input', filterProducts);
            document.getElementById('khata-search').addEventListener('input', filterKhata);
            document.getElementById('add-payment').addEventListener('click', addPayment);
        }
    
        function loadSettings() {
            const transaction = db.transaction(['settings'], 'readonly');
            const store = transaction.objectStore('settings');
            const request = store.get(1);
            
            request.onsuccess = function(event) {
                const settings = event.target.result;
                if (settings) {
                    document.getElementById('shop-name').value = settings.shopName || '';
                    document.getElementById('shop-address').value = settings.shopAddress || '';
                    document.getElementById('shop-phone').value = settings.shopPhone || '';
                    document.getElementById('next-receipt-number').value = settings.nextReceiptNumber || 1;
                    
                    document.getElementById('preview-shop-name').textContent = settings.shopName || 'دکان کا نام';
                    document.getElementById('preview-shop-address').textContent = settings.shopAddress || 'دکان کا پتہ';
                    document.getElementById('preview-shop-contact').textContent = 'فون: ' + (settings.shopPhone || 'XXX-XXXXXXX');
                    document.getElementById('preview-receipt-number').textContent = (settings.nextReceiptNumber || 1).toString().padStart(3, '0');
                } else {
                    // Initialize with default settings
                    const defaultSettings = {
                        id: 1,
                        shopName: 'دکان کا نام',
                        shopAddress: 'دکان کا پتہ',
                        shopPhone: 'XXX-XXXXXXX',
                        nextReceiptNumber: 1
                    };
                    
                    const saveTransaction = db.transaction(['settings'], 'readwrite');
                    const saveStore = saveTransaction.objectStore('settings');
                    saveStore.add(defaultSettings);
                    
                    document.getElementById('shop-name').value = defaultSettings.shopName;
                    document.getElementById('shop-address').value = defaultSettings.shopAddress;
                    document.getElementById('shop-phone').value = defaultSettings.shopPhone;
                    document.getElementById('next-receipt-number').value = defaultSettings.nextReceiptNumber;
                    
                    document.getElementById('preview-shop-name').textContent = defaultSettings.shopName;
                    document.getElementById('preview-shop-address').textContent = defaultSettings.shopAddress;
                    document.getElementById('preview-shop-contact').textContent = 'فون: ' + defaultSettings.shopPhone;
                    document.getElementById('preview-receipt-number').textContent = defaultSettings.nextReceiptNumber.toString().padStart(3, '0');
                }
            };
            
            // Set the date in preview
            const today = new Date();
            const dateString = today.toLocaleDateString('ur-PK');
            document.getElementById('preview-date').textContent = dateString;
        }
    
        function saveSettings() {
            const settings = {
                id: 1,
                shopName: document.getElementById('shop-name').value,
                shopAddress: document.getElementById('shop-address').value,
                shopPhone: document.getElementById('shop-phone').value,
                nextReceiptNumber: parseInt(document.getElementById('next-receipt-number').value, 10)
            };
            
            const transaction = db.transaction(['settings'], 'readwrite');
            const store = transaction.objectStore('settings');
            store.put(settings);
            
            transaction.oncomplete = function() {
                alert('ترتیبات محفوظ کر دی گئیں');
                
                // Update preview
                document.getElementById('preview-shop-name').textContent = settings.shopName;
                document.getElementById('preview-shop-address').textContent = settings.shopAddress;
                document.getElementById('preview-shop-contact').textContent = 'فون: ' + settings.shopPhone;
                document.getElementById('preview-receipt-number').textContent = settings.nextReceiptNumber.toString().padStart(3, '0');
            };
        }
    
        function saveReceiptSettings() {
            const transaction = db.transaction(['settings'], 'readwrite');
            const store = transaction.objectStore('settings');
            const request = store.get(1);
            
            request.onsuccess = function(event) {
                const settings = event.target.result || { id: 1 };
                settings.nextReceiptNumber = parseInt(document.getElementById('next-receipt-number').value, 10);
                
                store.put(settings);
                
                transaction.oncomplete = function() {
                    alert('بل نمبر محفوظ کر دیا گیا');
                    document.getElementById('preview-receipt-number').textContent = settings.nextReceiptNumber.toString().padStart(3, '0');
                };
            };
        }
    
        function loadCustomers() {
            const transaction = db.transaction(['customers'], 'readonly');
            const store = transaction.objectStore('customers');
            const request = store.openCursor();
            
            const customerSelect = document.getElementById('customer');
            customerSelect.innerHTML = '<option value="">نیا گاہک</option>';
            
            const customerList = document.getElementById('customer-list');
            customerList.innerHTML = '';
            
            request.onsuccess = function(event) {
                const cursor = event.target.result;
                if (cursor) {
                    const customer = cursor.value;
                    
                    // Add to customer select
                    const option = document.createElement('option');
                    option.value = customer.id;
                    option.textContent = customer.name;
                    customerSelect.appendChild(option);
                    
                    // Add to customer list
                    const listItem = document.createElement('div');
                    listItem.className = 'list-item';
                    listItem.textContent = customer.name;
                    listItem.setAttribute('data-id', customer.id);
                    listItem.addEventListener('click', function() {
                        showCustomerDetails(customer.id);
                    });
                    customerList.appendChild(listItem);
                    
                    cursor.continue();
                }
            };
        }
    
        function addCustomer() {
            const name = document.getElementById('new-customer-name').value;
            const phone = document.getElementById('new-customer-phone').value;
            const address = document.getElementById('new-customer-address').value;
            
            if (!name) {
                alert('براہ کرم گاہک کا نام درج کریں');
                return;
            }
            
            const customer = {
                name: name,
                phone: phone,
                address: address,
                createdAt: new Date()
            };
            
            const transaction = db.transaction(['customers'], 'readwrite');
            const store = transaction.objectStore('customers');
            const request = store.add(customer);
            
            request.onsuccess = function(event) {
                alert('گاہک شامل کر دیا گیا');
                document.getElementById('new-customer-name').value = '';
                document.getElementById('new-customer-phone').value = '';
                document.getElementById('new-customer-address').value = '';
                loadCustomers();
            };
            
            request.onerror = function(event) {
                alert('گاہک شامل نہیں کیا جا سکا');
            };
        }
    
        function showCustomerDetails(customerId) {
            const transaction = db.transaction(['customers', 'receipts'], 'readonly');
            const customerStore = transaction.objectStore('customers');
            const receiptStore = transaction.objectStore('receipts');
            const customerRequest = customerStore.get(parseInt(customerId, 10));
            
            customerRequest.onsuccess = function(event) {
                const customer = event.target.result;
                const detailsDiv = document.getElementById('customer-details');
                const contentDiv = document.getElementById('customer-details-content');
                
                if (customer) {
                    contentDiv.innerHTML = `
                        <div><strong>نام:</strong> ${customer.name}</div>
                        <div><strong>فون:</strong> ${customer.phone}</div>
                        <div><strong>پتہ:</strong> ${customer.address}</div>
                        <div><strong>شامل کردہ تاریخ:</strong> ${customer.createdAt.toLocaleDateString('ur-PK')}</div>
                    `;
                    
                    // Show customer history
                    const customerIndex = receiptStore.index('customerId');
                    const historyRequest = customerIndex.getAll(parseInt(customerId, 10));
                    
                    historyRequest.onsuccess = function(event) {
                        const receipts = event.target.result;
                        const historyTable = document.getElementById('customer-history');
                        const tbody = historyTable.querySelector('tbody');
                        tbody.innerHTML = '';
                        
                        if (receipts.length > 0) {
                            receipts.forEach(receipt => {
                                const row = document.createElement('tr');
                                row.innerHTML = `
                                    <td>${receipt.date.toLocaleDateString('ur-PK')}</td>
                                    <td>${receipt.receiptNumber}</td>
                                    <td>${receipt.totalAmount.toFixed(2)}</td>
                                    <td>${receipt.paidAmount.toFixed(2)}</td>
                                    <td>${(receipt.totalAmount - receipt.paidAmount).toFixed(2)}</td>
                                `;
                                tbody.appendChild(row);
                            });
                        } else {
                            const row = document.createElement('tr');
                            row.innerHTML = '<td colspan="5">کوئی بل نہیں ملا</td>';
                            tbody.appendChild(row);
                        }
                    };
                    
                    detailsDiv.style.display = 'block';
                    document.getElementById('edit-customer-id').value = customer.id;
                } else {
                    detailsDiv.style.display = 'none';
                }
            };
        }
    
        function showEditCustomerModal() {
            const customerId = document.getElementById('edit-customer-id').value;
            if (!customerId) return;
            
            const transaction = db.transaction(['customers'], 'readonly');
            const store = transaction.objectStore('customers');
            const request = store.get(parseInt(customerId, 10));
            
            request.onsuccess = function(event) {
                const customer = event.target.result;
                if (customer) {
                    document.getElementById('edit-customer-name').value = customer.name;
                    document.getElementById('edit-customer-phone').value = customer.phone;
                    document.getElementById('edit-customer-address').value = customer.address;
                    
                    document.getElementById('edit-customer-modal').style.display = 'block';
                }
            };
        }
    
        function closeEditCustomerModal() {
            document.getElementById('edit-customer-modal').style.display = 'none';
        }
    
        function updateCustomer() {
            const customerId = document.getElementById('edit-customer-id').value;
            if (!customerId) return;
            
            const name = document.getElementById('edit-customer-name').value;
            const phone = document.getElementById('edit-customer-phone').value;
            const address = document.getElementById('edit-customer-address').value;
            
            if (!name) {
                alert('براہ کرم گاہک کا نام درج کریں');
                return;
            }
            
            const transaction = db.transaction(['customers'], 'readwrite');
            const store = transaction.objectStore('customers');
            const request = store.get(parseInt(customerId, 10));
            
            request.onsuccess = function(event) {
                const customer = event.target.result;
                if (customer) {
                    customer.name = name;
                    customer.phone = phone;
                    customer.address = address;
                    
                    const updateRequest = store.put(customer);
                    updateRequest.onsuccess = function() {
                        alert('گاہک اپ ڈیٹ کر دیا گیا');
                        closeEditCustomerModal();
                        loadCustomers();
                        showCustomerDetails(customerId);
                    };
                }
            };
        }
    
        function deleteCustomer() {
            const customerId = document.getElementById('edit-customer-id').value;
            if (!customerId) return;
            
            if (confirm('کیا آپ واقعی یہ گاہک حذف کرنا چاہتے ہیں؟')) {
                const transaction = db.transaction(['customers', 'receipts', 'transactions'], 'readwrite');
                const customerStore = transaction.objectStore('customers');
                const receiptStore = transaction.objectStore('receipts');
                const transactionStore = transaction.objectStore('transactions');
                
                // Delete customer
                customerStore.delete(parseInt(customerId, 10));
                
                // Delete related receipts
                const receiptIndex = receiptStore.index('customerId');
                const receiptRequest = receiptIndex.openKeyCursor(IDBKeyRange.only(parseInt(customerId, 10)));
                
                receiptRequest.onsuccess = function(event) {
                    const cursor = event.target.result;
                    if (cursor) {
                        receiptStore.delete(cursor.primaryKey);
                        cursor.continue();
                    }
                };
                
                // Delete related transactions
                const transactionIndex = transactionStore.index('customerId');
                const transactionRequest = transactionIndex.openKeyCursor(IDBKeyRange.only(parseInt(customerId, 10)));
                
                transactionRequest.onsuccess = function(event) {
                    const cursor = event.target.result;
                    if (cursor) {
                        transactionStore.delete(cursor.primaryKey);
                        cursor.continue();
                    }
                };
                
                transaction.oncomplete = function() {
                    alert('گاہک حذف کر دیا گیا');
                    document.getElementById('customer-details').style.display = 'none';
                    loadCustomers();
                };
            }
        }
    
        function handleCustomerChange() {
            const customerId = document.getElementById('customer').value;
            
            if (customerId) {
                // Existing customer selected, load their details
                const transaction = db.transaction(['customers'], 'readonly');
const store = transaction.objectStore('customers');
const request = store.get(parseInt(customerId, 10));

                request.onsuccess = function(event) {
                    const customer = event.target.result;
                    if (customer) {
                        document.getElementById('customer-name').value = customer.name;
                        document.getElementById('customer-phone').value = customer.phone;
                        document.getElementById('customer-address').value = customer.address;
                        
                        // Update preview
                        document.getElementById('preview-customer-name').textContent = customer.name;
                        document.getElementById('preview-customer-phone').textContent = customer.phone;
                        document.getElementById('preview-customer-address').textContent = customer.address;
                    }
                };
                
                document.getElementById('new-customer-form').style.display = 'none';
            } else {
                // New customer, show form
                document.getElementById('new-customer-form').style.display = 'block';
                document.getElementById('customer-name').value = '';
                document.getElementById('customer-phone').value = '';
                document.getElementById('customer-address').value = '';
                
                // Update preview
                document.getElementById('preview-customer-name').textContent = 'گاہک کا نام';
                document.getElementById('preview-customer-phone').textContent = 'گاہک کا فون';
                document.getElementById('preview-customer-address').textContent = 'گاہک کا پتہ';
            }
        }
    
        function loadProducts() {
            const transaction = db.transaction(['products'], 'readonly');
            const store = transaction.objectStore('products');
            const request = store.openCursor();
            
            const productSelect = document.getElementById('product');
            productSelect.innerHTML = '<option value="">منتخب کریں</option>';
            
            const productList = document.getElementById('product-list');
            productList.innerHTML = '';
            
            request.onsuccess = function(event) {
                const cursor = event.target.result;
                if (cursor) {
                    const product = cursor.value;
                    
                    // Add to product select
                    const option = document.createElement('option');
                    option.value = product.id;
                    option.textContent = product.name;
                    option.setAttribute('data-rate', product.rate);
                    option.setAttribute('data-description', product.description);
                    productSelect.appendChild(option);
                    
                    // Add to product list
                    const listItem = document.createElement('div');
                    listItem.className = 'list-item';
                    listItem.textContent = product.name;
                    listItem.setAttribute('data-id', product.id);
                    listItem.addEventListener('click', function() {
                        showProductDetails(product.id);
                    });
                    productList.appendChild(listItem);
                    
                    cursor.continue();
                }
            };
        }
    
        function addProduct() {
            const name = document.getElementById('new-product-name').value;
            const description = document.getElementById('new-product-description').value;
            const rate = parseFloat(document.getElementById('new-product-rate').value);
            
            if (!name) {
                alert('براہ کرم پروڈکٹ کا نام درج کریں');
                return;
            }
            
            if (isNaN(rate) || rate < 0) {
                alert('براہ کرم درست نرخ درج کریں');
                return;
            }
            
            const product = {
                name: name,
                description: description,
                rate: rate,
                createdAt: new Date()
            };
            
            const transaction = db.transaction(['products'], 'readwrite');
            const store = transaction.objectStore('products');
            const request = store.add(product);
            
            request.onsuccess = function(event) {
                alert('پروڈکٹ شامل کر دیا گیا');
                document.getElementById('new-product-name').value = '';
                document.getElementById('new-product-description').value = '';
                document.getElementById('new-product-rate').value = '';
                loadProducts();
            };
            
            request.onerror = function(event) {
                alert('پروڈکٹ شامل نہیں کیا جا سکا');
            };
        }
    
        function showProductDetails(productId) {
            const transaction = db.transaction(['products'], 'readonly');
            const store = transaction.objectStore('products');
            const request = store.get(parseInt(productId, 10));
            
            request.onsuccess = function(event) {
                const product = event.target.result;
                const detailsDiv = document.getElementById('product-details');
                const contentDiv = document.getElementById('product-details-content');
                
                if (product) {
                    contentDiv.innerHTML = `
                        <div><strong>نام:</strong> ${product.name}</div>
                        <div><strong>تفصیل:</strong> ${product.description}</div>
                        <div><strong>نرخ:</strong> ${product.rate.toFixed(2)}</div>
                        <div><strong>شامل کردہ تاریخ:</strong> ${product.createdAt.toLocaleDateString('ur-PK')}</div>
                    `;
                    
                    detailsDiv.style.display = 'block';
                    document.getElementById('edit-product-id').value = product.id;
                } else {
                    detailsDiv.style.display = 'none';
                }
            };
        }
    
        function showEditProductModal() {
            const productId = document.getElementById('edit-product-id').value;
            if (!productId) return;
            
            const transaction = db.transaction(['products'], 'readonly');
            const store = transaction.objectStore('products');
            const request = store.get(parseInt(productId, 10));
            
            request.onsuccess = function(event) {
                const product = event.target.result;
                if (product) {
                    document.getElementById('edit-product-name').value = product.name;
                    document.getElementById('edit-product-description').value = product.description;
                    document.getElementById('edit-product-rate').value = product.rate;
                    
                    document.getElementById('edit-product-modal').style.display = 'block';
                }
            };
        }
    
        function closeEditProductModal() {
            document.getElementById('edit-product-modal').style.display = 'none';
        }
    
        function updateProduct() {
            const productId = document.getElementById('edit-product-id').value;
            if (!productId) return;
            
            const name = document.getElementById('edit-product-name').value;
            const description = document.getElementById('edit-product-description').value;
            const rate = parseFloat(document.getElementById('edit-product-rate').value);
            
            if (!name) {
                alert('براہ کرم پروڈکٹ کا نام درج کریں');
                return;
            }
            
            if (isNaN(rate) || rate < 0) {
                alert('براہ کرم درست نرخ درج کریں');
                return;
            }
            
            const transaction = db.transaction(['products'], 'readwrite');
            const store = transaction.objectStore('products');
            const request = store.get(parseInt(productId, 10));
            
            request.onsuccess = function(event) {
                const product = event.target.result;
                if (product) {
                    product.name = name;
                    product.description = description;
                    product.rate = rate;
                    
                    const updateRequest = store.put(product);
                    updateRequest.onsuccess = function() {
                        alert('پروڈکٹ اپ ڈیٹ کر دیا گیا');
                        closeEditProductModal();
                        loadProducts();
                        showProductDetails(productId);
                    };
                }
            };
        }
    
        function deleteProduct() {
            const productId = document.getElementById('edit-product-id').value;
            if (!productId) return;
            
            if (confirm('کیا آپ واقعی یہ پروڈکٹ حذف کرنا چاہتے ہیں؟')) {
                const transaction = db.transaction(['products'], 'readwrite');
                const store = transaction.objectStore('products');
                
                store.delete(parseInt(productId, 10));
                
                transaction.oncomplete = function() {
                    alert('پروڈکٹ حذف کر دیا گیا');
                    document.getElementById('product-details').style.display = 'none';
                    loadProducts();
                };
            }
        }
    
        // Receipt functionality
        let receiptItems = [];
    
        function addItemToReceipt() {
            const productSelect = document.getElementById('product');
            const productId = productSelect.value;
            
            if (!productId) {
                alert('براہ کرم پروڈکٹ منتخب کریں');
                return;
            }
            
            const selectedOption = productSelect.options[productSelect.selectedIndex];
            const quantity = parseInt(document.getElementById('quantity').value, 10);
            
            if (isNaN(quantity) || quantity <= 0) {
                alert('براہ کرم درست تعداد درج کریں');
                return;
            }
            
            const item = {
                id: Date.now(), // Unique ID for this item
                productId: parseInt(productId, 10),
                name: selectedOption.textContent,
                description: selectedOption.getAttribute('data-description'),
                rate: parseFloat(selectedOption.getAttribute('data-rate')),
                quantity: quantity,
                total: parseFloat(selectedOption.getAttribute('data-rate')) * quantity
            };
            
            receiptItems.push(item);
            
            // Update the table
            updateItemsTable();
            
            // Update totals
            updateTotals();
            
            // Clear inputs
            document.getElementById('quantity').value = 1;
        }
    
        function updateItemsTable() {
            const tbody = document.getElementById('items-table').querySelector('tbody');
            tbody.innerHTML = '';
            
            receiptItems.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${item.quantity}</td>
                    <td>${item.name} ${item.description ? '- ' + item.description : ''}</td>
                    <td>${item.rate.toFixed(2)}</td>
                    <td>${item.total.toFixed(2)}</td>
                    <td>
                        <button class="remove-item" data-id="${item.id}">حذف کریں</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // Add event listeners to remove buttons
            const removeButtons = document.querySelectorAll('.remove-item');
            removeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const itemId = parseInt(this.getAttribute('data-id'), 10);
                    removeItemFromReceipt(itemId);
                });
            });
            
            // Update preview table
            const previewTbody = document.getElementById('preview-items-table').querySelector('tbody');
            previewTbody.innerHTML = '';
            
            receiptItems.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${item.quantity}</td>
                    <td>${item.name} ${item.description ? '- ' + item.description : ''}</td>
                    <td>${item.rate.toFixed(2)}</td>
                    <td>${item.total.toFixed(2)}</td>
                `;
                previewTbody.appendChild(row);
            });
        }
    
        function removeItemFromReceipt(itemId) {
            receiptItems = receiptItems.filter(item => item.id !== itemId);
            updateItemsTable();
            updateTotals();
        }
    
        function updateTotals() {
            const totalAmount = receiptItems.reduce((sum, item) => sum + item.total, 0);
            const discount = parseFloat(document.getElementById('discount').value) || 0;
            const netAmount = totalAmount - discount;
            const paidAmount = parseFloat(document.getElementById('amount-paid').value) || 0;
            const remainingAmount = netAmount - paidAmount;
            
            document.getElementById('total-amount').textContent = totalAmount.toFixed(2);
            document.getElementById('discount-amount').textContent = discount.toFixed(2);
            document.getElementById('net-amount').textContent = netAmount.toFixed(2);
            document.getElementById('paid-amount').textContent = paidAmount.toFixed(2);
            document.getElementById('remaining-amount').textContent = remainingAmount.toFixed(2);
            
            // Update preview
            document.getElementById('preview-total-amount').textContent = totalAmount.toFixed(2);
            document.getElementById('preview-discount-amount').textContent = discount.toFixed(2);
            document.getElementById('preview-net-amount').textContent = netAmount.toFixed(2);
            document.getElementById('preview-paid-amount').textContent = paidAmount.toFixed(2);
            document.getElementById('preview-remaining-amount').textContent = remainingAmount.toFixed(2);
        }
    
        function generateReceipt() {
            if (receiptItems.length === 0) {
                alert('براہ کرم کم از کم ایک آئٹم شامل کریں');
                return;
            }
            
            // Set current date in preview
            const receiptDate = document.getElementById('receipt-date').valueAsDate || new Date();
            document.getElementById('preview-date').textContent = receiptDate.toLocaleDateString('ur-PK');
            
            // Set customer info
            const customerId = document.getElementById('customer').value;
            if (customerId) {
                // Existing customer
                const transaction = db.transaction(['customers'], 'readonly');
                const store = transaction.objectStore('customers');
                const request = store.get(parseInt(customerId, 10));
                
                request.onsuccess = function(event) {
                    const customer = event.target.result;
                    if (customer) {
                        document.getElementById('preview-customer-name').textContent = customer.name;
                        document.getElementById('preview-customer-phone').textContent = customer.phone;
                        document.getElementById('preview-customer-address').textContent = customer.address;
                    }
                };
            } else {
                // New customer
                document.getElementById('preview-customer-name').textContent = document.getElementById('customer-name').value || 'گاہک کا نام';
                document.getElementById('preview-customer-phone').textContent = document.getElementById('customer-phone').value || 'گاہک کا فون';
                document.getElementById('preview-customer-address').textContent = document.getElementById('customer-address').value || 'گاہک کا پتہ';
            }
        }
    
        function saveReceipt() {
            if (receiptItems.length === 0) {
                alert('براہ کرم کم از کم ایک آئٹم شامل کریں');
                return;
            }
            
            let customerId = document.getElementById('customer').value;
            const receiptDate = document.getElementById('receipt-date').valueAsDate || new Date();
            const totalAmount = receiptItems.reduce((sum, item) => sum + item.total, 0);
            const discount = parseFloat(document.getElementById('discount').value) || 0;
            const netAmount = totalAmount - discount;
            const paidAmount = parseFloat(document.getElementById('amount-paid').value) || 0;
            const remainingAmount = netAmount - paidAmount;
            
            const transaction = db.transaction(['settings', 'customers', 'receipts', 'transactions'], 'readwrite');
            const settingsStore = transaction.objectStore('settings');
            const customerStore = transaction.objectStore('customers');
            const receiptStore = transaction.objectStore('receipts');
            const transactionStore = transaction.objectStore('transactions');
            
            // Get receipt number
            const settingsRequest = settingsStore.get(1);
            
            settingsRequest.onsuccess = function(event) {
                const settings = event.target.result || { id: 1, nextReceiptNumber: 1 };
                const receiptNumber = settings.nextReceiptNumber.toString().padStart(3, '0');
                
                // Save customer if new
                if (!customerId) {
                    const customerName = document.getElementById('customer-name').value;
                    const customerPhone = document.getElementById('customer-phone').value;
                    const customerAddress = document.getElementById('customer-address').value;
                    
                    if (!customerName) {
                        alert('براہ کرم گاہک کا نام درج کریں');
                        return;
                    }
                    
                    const newCustomer = {
                        name: customerName,
                        phone: customerPhone,
                        address: customerAddress,
                        createdAt: new Date()
                    };
                    
                    const customerRequest = customerStore.add(newCustomer);
                    
                    customerRequest.onsuccess = function(event) {
                        customerId = event.target.result;
                        saveReceiptAndTransaction(customerId);
                    };
                } else {
                    saveReceiptAndTransaction(parseInt(customerId, 10));
                }
                
                function saveReceiptAndTransaction(cid) {
                    // Save receipt
                    const receipt = {
                        receiptNumber: receiptNumber,
                        customerId: cid,
                        date: receiptDate,
                        items: receiptItems,
                        totalAmount: totalAmount,
                        discount: discount,
                        netAmount: netAmount,
                        paidAmount: paidAmount,
                        remainingAmount: remainingAmount,
                        createdAt: new Date()
                    };
                    
                    const receiptRequest = receiptStore.add(receipt);
                    
                    receiptRequest.onsuccess = function(event) {
                        const receiptId = event.target.result;
                        
                        // Save transaction for khata
                        if (remainingAmount > 0) {
                            const transaction = {
                                customerId: cid,
                                receiptId: receiptId,
                                date: receiptDate,
                                description: 'بل نمبر ' + receiptNumber,
                                debit: netAmount,
                                credit: paidAmount,
                                balance: remainingAmount,
                                createdAt: new Date()
                            };
                            
                            transactionStore.add(transaction);
                        }
                        
                        // Update receipt number
                        settings.nextReceiptNumber = settings.nextReceiptNumber + 1;
                        settingsStore.put(settings);
                        
                        alert('بل محفوظ کر دیا گیا');
                        
                        // Reset form
                        resetReceiptForm();
                        
                        // Reload data
                        loadCustomers();
                        loadKhata();
                    };
                }
            };
        }
    
        function resetReceiptForm() {
            receiptItems = [];
            document.getElementById('customer').value = '';
            document.getElementById('customer-name').value = '';
            document.getElementById('customer-phone').value = '';
            document.getElementById('customer-address').value = '';
            document.getElementById('quantity').value = 1;
            document.getElementById('discount').value = 0;
            document.getElementById('amount-paid').value = 0;
            document.getElementById('receipt-date').valueAsDate = new Date();
            
            // Update tables and totals
            updateItemsTable();
            updateTotals();
            
            // Update preview
            document.getElementById('preview-customer-name').textContent = 'گاہک کا نام';
            document.getElementById('preview-customer-phone').textContent = 'گاہک کا فون';
            document.getElementById('preview-customer-address').textContent = 'گاہک کا پتہ';
            
            // Load next receipt number
            loadSettings();
        }
    
        function printReceipt() {
            window.print();
        }
    
        function loadKhata() {
            const transaction = db.transaction(['customers', 'transactions'], 'readonly');
            const customerStore = transaction.objectStore('customers');
            const transactionStore = transaction.objectStore('transactions');
            const customerRequest = customerStore.openCursor();
            
            const khataTable = document.getElementById('khata-table').querySelector('tbody');
            khataTable.innerHTML = '';
            
            customerRequest.onsuccess = function(event) {
                const cursor = event.target.result;
                if (cursor) {
                    const customer = cursor.value;
                    const customerId = customer.id;
                    
                    const transactionIndex = transactionStore.index('customerId');
                    const transactionRequest = transactionIndex.getAll(customerId);
                    
                    transactionRequest.onsuccess = function(event) {
                        const transactions = event.target.result;
                        
                        if (transactions.length > 0) {
                            // Calculate total balance
                            let totalBalance = 0;
                            let latestTransaction = null;
                            
                            transactions.forEach(txn => {
                                totalBalance += (txn.debit - txn.credit);
                                
                                if (!latestTransaction || txn.date > latestTransaction.date) {
                                    latestTransaction = txn;
                                }
                            });
                            
                            if (totalBalance > 0) {
                                const row = document.createElement('tr');
                                row.innerHTML = `
                                    <td>${customer.name}</td>
                                    <td>${totalBalance.toFixed(2)}</td>
                                    <td>${latestTransaction ? latestTransaction.date.toLocaleDateString('ur-PK') : '-'}</td>
                                    <td>
                                        <button class="view-khata" data-id="${customerId}">دیکھیں</button>
                                    </td>
                                `;
                                khataTable.appendChild(row);
                                
                                // Add event listener
                                row.querySelector('.view-khata').addEventListener('click', function() {
                                    showKhataDetails(customerId);
                                });
                            }
                        }
                    };
                    
                    cursor.continue();
                }
            };
        }
    
        function showKhataDetails(customerId) {
            const transaction = db.transaction(['customers', 'transactions'], 'readonly');
            const customerStore = transaction.objectStore('customers');
            const transactionStore = transaction.objectStore('transactions');
            
            const customerRequest = customerStore.get(parseInt(customerId, 10));
            
            customerRequest.onsuccess = function(event) {
                const customer = event.target.result;
                
                if (customer) {
                    const khataDetails = document.getElementById('khata-details');
                    const customerInfo = document.getElementById('khata-customer-info');
                    
                    customerInfo.innerHTML = `
                        <h3>${customer.name}</h3>
                        <div>فون: ${customer.phone}</div>
                        <div>پتہ: ${customer.address}</div>
                    `;
                    
                    // Load transactions
                    const transactionIndex = transactionStore.index('customerId');
                    const transactionRequest = transactionIndex.getAll(customerId);
                    
                    transactionRequest.onsuccess = function(event) {
                        const transactions = event.target.result;
                        const historyTable = document.getElementById('khata-history');
                        const tbody = historyTable.querySelector('tbody');
                        tbody.innerHTML = '';
                        
                        let balance = 0;
                        
                        transactions.sort((a, b) => a.date - b.date).forEach(txn => {
                            balance += (txn.debit - txn.credit);
                            
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${txn.date.toLocaleDateString('ur-PK')}</td>
                                <td>${txn.description}</td>
                                <td>${txn.debit.toFixed(2)}</td>
                                <td>${txn.credit.toFixed(2)}</td>
                                <td>${balance.toFixed(2)}</td>
                            `;
                            tbody.appendChild(row);
                        });
                    };
                    
                    // Set customer ID for payment
                    document.getElementById('payment-amount').setAttribute('data-customer-id', customerId);
                    
                    khataDetails.style.display = 'block';
                }
            };
        }
    
        function addPayment() {
            const customerId = document.getElementById('payment-amount').getAttribute('data-customer-id');
            const paymentAmount = parseFloat(document.getElementById('payment-amount').value);
            
            if (!customerId) {
                alert('براہ کرم پہلے گاہک منتخب کریں');
                return;
            }
            
            if (isNaN(paymentAmount) || paymentAmount <= 0) {
                alert('براہ کرم درست رقم درج کریں');
                return;
            }
            
            const transaction = db.transaction(['transactions'], 'readwrite');
            const store = transaction.objectStore('transactions');
            
            const payment = {
                customerId: parseInt(customerId, 10),
                date: new Date(),
                description: 'ادائیگی',
                debit: 0,
                credit: paymentAmount,
                balance: 0, // Will be calculated when showing khata
                createdAt: new Date()
            };
            
            const request = store.add(payment);
            
            request.onsuccess = function(event) {
                alert('ادائیگی شامل کر دی گئی');
                document.getElementById('payment-amount').value = '';
                showKhataDetails(customerId);
                loadKhata();
            };
        }
    
        function filterCustomers() {
            const searchTerm = document.getElementById('customer-search').value.toLowerCase();
            const customerList = document.getElementById('customer-list');
            const items = customerList.querySelectorAll('.list-item');
            
            items.forEach(item => {
                const name = item.textContent.toLowerCase();
                if (name.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }
    
        function filterProducts() {
            const searchTerm = document.getElementById('product-search').value.toLowerCase();
            const productList = document.getElementById('product-list');
            const items = productList.querySelectorAll('.list-item');
            
            items.forEach(item => {
                const name = item.textContent.toLowerCase();
                if (name.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }
    
        function filterKhata() {
            const searchTerm = document.getElementById('khata-search').value.toLowerCase();
            const khataTable = document.getElementById('khata-table').querySelector('tbody');
            const rows = khataTable.querySelectorAll('tr');
            
            rows.forEach(row => {
                const customerName = row.querySelector('td').textContent.toLowerCase();
                if (customerName.includes(searchTerm)) {
                    row.style.display = 'table-row';
                } else {
                    row.style.display = 'none';
                }
            });
        }
    </script>
    </body>
</html>